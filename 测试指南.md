# 灵犀助教 - 测试指南

## 🧪 测试前准备

### 环境检查

```powershell
# 1. 检查 Python 和 uv
python --version  # 应显示 3.10+
uv --version      # 应显示 uv 版本

# 2. 检查 Node.js（桌面客户端需要）
node --version    # 应显示 16+
npm --version     # 应显示 npm 版本

# 3. 检查 CUDA（如果有 GPU）
nvidia-smi        # 应显示 GPU 信息
```

### 首次启动

```powershell
# 进入项目目录
cd d:\Desktop\软件课设\Open-LLM-VTuber-v1.2.1-zh

# 使用启动脚本
.\启动灵犀助教.ps1

# 或手动启动
uv run run_server.py
```

---

## ✅ 核心功能测试清单

### 1. 基础配置测试 ✔️

#### 测试点：角色名称和人设

**操作**：
1. 启动应用
2. 说"你好"或输入文本

**预期结果**：
- AI 自我介绍为"灵犀"
- 称呼用户为"同学"
- 回答风格专业、耐心

**示例对话**：
```
用户：你好，你是谁？
灵犀：你好，同学！我是灵犀，你的AI学习助教。我的使命是帮助你高效学习、深入理解知识。无论是课程内容、习题解答还是知识拓展，我都很乐意协助你！有什么我可以帮到你的吗？
```

---

### 2. 语音交互测试 ✔️

#### 测试点：FunASR 语音识别

**操作**：
1. 点击麦克风按钮
2. 清晰说出："什么是二叉树？"
3. 等待识别和回答

**预期结果**：
- 实时显示识别文本
- 延迟 < 1秒
- 识别准确（中文普通话）

**检查项**：
- [ ] 麦克风权限已授予
- [ ] 识别文本正确显示
- [ ] GPU 加速生效（查看 nvidia-smi）

#### 测试点：Edge TTS 语音合成

**预期结果**：
- 自然流畅的女声
- 无明显机器感
- 音量适中

---

### 3. Markdown 渲染测试 ✔️

#### 测试用例 1：基础 Markdown

**输入**：
```
请用 Markdown 格式介绍二叉树的基本概念
```

**预期输出应包含**：
- ✅ 标题层级（# ## ###）
- ✅ 粗体 **加粗文本**
- ✅ 列表（- 或 1.）
- ✅ 代码块高亮

**检查点**：
- [ ] 标题有不同大小和样式
- [ ] 粗体文本加粗显示
- [ ] 列表有项目符号
- [ ] 代码块有深色背景

#### 测试用例 2：复杂 Markdown

**输入**：
```
用表格对比冒泡排序和快速排序
```

**预期输出应包含**：
- ✅ 表格（带表头和行）
- ✅ 斑马纹效果
- ✅ 表头蓝色背景

---

### 4. LaTeX 公式渲染测试 ✔️

#### 测试用例 1：行内公式

**输入**：
```
解释速度公式
```

**预期包含**：
```
速度公式为 $v = \frac{s}{t}$
```

**检查点**：
- [ ] 公式正确渲染（不是纯文本）
- [ ] 分数显示正确
- [ ] 字体美观

#### 测试用例 2：块级公式

**输入**：
```
写出二次方程求根公式
```

**预期包含**：
```
$$
x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}
$$
```

**检查点**：
- [ ] 公式居中显示
- [ ] 大小合适（略大于正文）
- [ ] 根号、分数正确渲染

#### 测试用例 3：复杂公式

**输入**：
```
写出泰勒级数展开式
```

**预期包含求和符号、上下标等**

---

### 5. 图片理解测试 ✔️

#### 测试用例 1：课件截图

**操作**：
1. 截取一张包含文字的课件图片
2. 上传图片
3. 询问："请讲解这张图片的内容"

**预期结果**：
- AI 能识别图片中的文字
- 提炼关键知识点
- 进行详细讲解

#### 测试用例 2：数学题图片

**操作**：
1. 拍摄或截取一道数学题
2. 上传并询问："帮我解答这道题"

**预期结果**：
- 识别题目内容
- 给出解题思路
- 逐步讲解

**示例题目**：
```
求解方程：x^2 - 5x + 6 = 0
```

#### 测试用例 3：流程图/示意图

**操作**：
上传算法流程图或概念示意图

**预期结果**：
- 识别图表结构
- 解释各部分含义
- 关联相关知识

---

### 6. 桌宠模式测试 ✔️

#### 测试点 1：启动桌宠模式

**操作**：
1. 启动桌面客户端
2. 应默认为桌宠模式

**预期结果**：
- 窗口大小：约 400x600
- 位置：屏幕右下角
- 透明背景
- 无边框
- 置顶显示
- 不在任务栏显示

#### 测试点 2：鼠标悬停交互

**操作**：
1. 鼠标移出窗口
2. 鼠标移入窗口

**预期结果**：
- 移出时：设置面板隐藏（透明）
- 移入时：设置面板显示

#### 测试点 3：快捷键

**Ctrl+Shift+L - 模式切换**

**操作**：按下 Ctrl+Shift+L

**预期结果**：
- 窗口放大（约 1200x800）
- 移动到屏幕中央偏右
- 可以调整大小
- 显示在任务栏

**再次按下**：
- 恢复桌宠模式

**Ctrl+Shift+H - 隐藏/显示**

**操作**：按下 Ctrl+Shift+H

**预期结果**：
- 窗口隐藏
- 再次按下窗口显示

**Ctrl+Shift+Q - 退出**

**操作**：按下 Ctrl+Shift+Q

**预期结果**：
- 应用完全退出

---

### 7. 学习场景测试 ✔️

#### 场景 1：概念讲解

**对话**：
```
用户：什么是递归？
灵犀：[应提供结构化、分步骤的讲解，包含：
      - 概念定义
      - 形象比喻
      - 代码示例
      - 应用场景]
```

#### 场景 2：习题解答

**对话**：
```
用户：如何求解一元二次方程？
灵犀：[应包含：
      - 求根公式
      - LaTeX 渲染的公式
      - 分步骤讲解
      - 实例演示]
```

#### 场景 3：知识拓展

**对话**：
```
用户：除了冒泡排序，还有哪些排序算法？
灵犀：[应提供：
      - 多种排序算法列表
      - 简要对比
      - 使用场景建议
      - 学习路径]
```

---

## 🐛 常见问题排查

### 问题 1：语音识别不工作

**症状**：点击麦克风没反应

**排查步骤**：
1. 检查浏览器麦克风权限
2. 查看控制台错误信息
3. 确认 FunASR 模型已下载
4. 检查后端日志：`logs/debug_*.log`

**解决方法**：
```powershell
# 检查模型
ls models/

# 重新下载模型（如果缺失）
# 启动时会自动下载
```

### 问题 2：Markdown 不渲染

**症状**：看到纯文本 Markdown 标记

**排查步骤**：
1. 打开浏览器开发者工具（F12）
2. 查看控制台是否有错误
3. 检查 Marked.js 和 KaTeX 是否加载

**解决方法**：
```javascript
// 在浏览器控制台执行
console.log(window.marked);  // 应有输出
console.log(window.katex);   // 应有输出
```

如果为 undefined，检查网络连接（需要访问 CDN）

### 问题 3：LaTeX 公式不显示

**症状**：看到 `$...$` 或 `$$...$$` 原始文本

**排查步骤**：
1. 确认 KaTeX CSS 已加载
2. 检查公式语法是否正确
3. 查看浏览器控制台错误

**解决方法**：
- 刷新页面
- 检查网络连接
- 验证 LaTeX 语法

### 问题 4：图片上传无响应

**症状**：上传图片后没有回应

**排查步骤**：
1. 检查 API 密钥是否正确
2. 查看网络请求（F12 → Network）
3. 确认图片格式（JPG/PNG/WebP）
4. 检查图片大小（<10MB）

**解决方法**：
```yaml
# 检查 conf.yaml
openai_compatible_llm:
  llm_api_key: 'your-valid-key'  # 确保有效
```

### 问题 5：桌宠模式样式不对

**症状**：悬停不显示控制面板

**原因**：前端 DOM 结构可能与预期不符

**解决方法**：
1. 检查实际的 DOM 结构（F12 → Elements）
2. 调整 `desktop_launcher/main.js` 中的 CSS 选择器
3. 可能需要根据实际情况微调

---

## 📊 性能监控

### GPU 使用监控

```powershell
# 实时监控 GPU
nvidia-smi -l 1
```

**预期**：
- FunASR 运行时显存占用 ~2GB
- GPU 利用率 > 50%（识别时）

### 内存监控

```powershell
# Windows 任务管理器
# Ctrl+Shift+Esc → 性能

# 或使用 PowerShell
Get-Process python | Select-Object Name, WS
```

**预期**：
- Python 进程 < 4GB
- Electron 进程 < 500MB

### 响应时间测试

**测量方法**：
1. 开始说话 → 记录时间
2. 收到完整回答 → 记录时间
3. 计算差值

**预期时间**：
- 语音识别：< 500ms
- LLM 首字：~1s
- 完整回答：取决于长度

---

## ✅ 完整测试检查表

### 功能测试

- [ ] 基础对话正常
- [ ] 语音识别准确
- [ ] 语音合成自然
- [ ] Markdown 正确渲染
- [ ] LaTeX 公式显示正确
- [ ] 图片上传和识别工作
- [ ] 桌宠模式正常
- [ ] 快捷键响应
- [ ] 模式切换顺畅

### 性能测试

- [ ] GPU 加速生效
- [ ] 内存占用正常
- [ ] 响应时间合理
- [ ] 长时间运行稳定

### 用户体验测试

- [ ] 界面美观
- [ ] 操作流畅
- [ ] 回答质量高
- [ ] 错误提示清晰

---

## 📝 测试报告模板

```markdown
# 灵犀助教测试报告

## 测试环境
- 系统：Windows 11
- CPU：Intel i7-12700
- GPU：RTX 4060
- 内存：16GB
- Python：3.11.0
- Node.js：20.10.0

## 测试结果

### 功能测试
- [x] 基础对话：✅ 通过
- [x] 语音交互：✅ 通过
- [x] Markdown 渲染：✅ 通过
- [x] LaTeX 公式：✅ 通过
- [x] 图片理解：✅ 通过
- [x] 桌宠模式：⚠️ 部分通过（悬停需调整）

### 性能数据
- 显存占用：2.1GB
- 内存占用：3.8GB
- 平均响应时间：1.2s
- GPU 利用率：65%

### 发现的问题
1. 鼠标悬停灵敏度需要调整
2. 首次启动需要较长时间（模型下载）
3. 偶尔 LaTeX 渲染失败（刷新可解决）

### 改进建议
1. 优化悬停检测逻辑
2. 添加首次启动进度提示
3. 增强 LaTeX 错误处理

### 总体评价
✅ 功能完整，体验良好，满足课程设计要求
```

---

## 🎯 演示准备

### 演示场景 1：基础介绍

**脚本**：
```
1. 启动应用（桌宠模式）
2. 说明项目背景和目标
3. 展示 Live2D 形象
4. 进行简单对话
```

### 演示场景 2：核心功能

**脚本**：
```
1. 语音提问："什么是二叉树？"
2. 展示 Markdown 渲染的回答
3. 追问："请用数学公式说明"
4. 展示 LaTeX 公式渲染
```

### 演示场景 3：图片理解

**脚本**：
```
1. 准备一张数学题图片
2. 上传图片
3. 请求解答
4. 展示 AI 的理解和讲解
```

### 演示场景 4：桌宠模式

**脚本**：
```
1. 演示鼠标悬停效果
2. 使用快捷键切换模式
3. 展示窗口拖动和调整
```

---

**测试愉快！如有问题，请查看日志文件：`logs/debug_*.log`** 🎉
