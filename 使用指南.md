# 灵犀助教 - 使用指南

## 🎓 项目简介

**灵犀助教**是一个基于多模态交互的个性化知识自学软件，通过 Live2D 数字人形象、语音交互和视觉理解能力，为学生和自学者提供生动的知识讲解与拓展服务。

## 🚀 快速开始

### 首次运行

1. **启动服务**
   ```powershell
   # Windows PowerShell
   .\启动灵犀助教.ps1
   ```

2. **选择模式**
   - 选项 1：桌面客户端模式（推荐）- 桌宠模式，可悬浮在桌面上
   - 选项 2：网页浏览器模式 - 在浏览器中使用
   - 选项 3：仅启动后端 - 用于开发调试

### 系统要求

- **操作系统**: Windows 10/11
- **Python**: 3.10+
- **Node.js**: 16+ (仅桌面客户端需要)
- **GPU**: NVIDIA RTX 4060 或更高（用于 CUDA 加速）
- **内存**: 建议 16GB+

## 📖 功能说明

### 1. 语音交互
- **语音识别**: 基于 FunASR，支持中文普通话识别
- **语音合成**: 基于 Edge TTS，提供自然流畅的语音输出
- **实时对话**: 支持自然的语音对话，无需等待

### 2. 视觉理解
- **图片理解**: 上传课件、笔记、习题图片，AI 会自动识别并讲解
- **截图分析**: 支持屏幕截图，快速解答学习问题
- **多模态交互**: 结合语音和图像的综合理解

### 3. 桌宠模式
- **透明背景**: 可爱的 Live2D 形象悬浮在桌面
- **鼠标悬停**: 移动鼠标到窗口区域即可显示控制面板
- **全局快捷键**:
  - `Ctrl+Shift+L`: 切换桌宠/正常模式
  - `Ctrl+Shift+H`: 隐藏/显示窗口
  - `Ctrl+Shift+Q`: 退出应用

### 4. 智能回答
- **Markdown 格式**: 清晰的结构化回答
- **数学公式**: 支持 LaTeX 公式渲染
- **代码高亮**: 程序代码自动高亮显示
- **分步讲解**: 复杂知识点分步骤详细说明

## 🎯 使用场景

### 场景1：课件学习
1. 拖拽或上传课件图片
2. AI 自动识别内容并提炼要点
3. 语音询问不理解的地方
4. 获得详细的讲解和拓展知识

### 场景2：习题解答
1. 上传习题截图
2. 说出"帮我讲解这道题"
3. AI 分析题目并给出解题思路
4. 提供相关知识点和类似题目

### 场景3：知识拓展
1. 询问某个知识点
2. AI 进行系统化讲解
3. 提供知识体系和学习路径
4. 推荐相关学习资源

### 场景4：学习计划
1. 说出学习目标
2. AI 制定个性化学习计划
3. 定期检查学习进度
4. 调整学习策略

## ⚙️ 配置说明

### conf.yaml 核心配置

```yaml
character_config:
  character_name: '灵犀'  # AI 助教名称
  human_name: '同学'       # 对用户的称呼
  
  agent_config:
    llm_provider: 'openai_compatible_llm'  # 使用 StepFun API
    
  asr_config:
    asr_model: 'fun_asr'  # 语音识别引擎
    
  tts_config:
    tts_model: 'edge_tts'  # 语音合成引擎
    voice: 'zh-CN-XiaoxiaoNeural'  # 中文女声
```

### 切换语音音色

编辑 `conf.yaml`:
```yaml
tts_config:
  edge_tts:
    voice: 'zh-CN-XiaoxiaoNeural'  # 女声（默认）
    # voice: 'zh-CN-YunxiNeural'   # 男声
    # voice: 'zh-CN-XiaoyiNeural'  # 儿童声
```

查看所有可用音色:
```bash
edge-tts --list-voices
```

## 🐛 常见问题

### Q1: 首次启动时间较长
**A**: 首次运行需要下载 FunASR 模型（约 500MB），请耐心等待并保持网络连接。下载完成后即可离线使用。

### Q2: 语音识别不准确
**A**: 
- 确保麦克风权限已开启
- 尽量在安静环境下使用
- 说话清晰，语速适中
- 检查 FunASR 是否使用了 CUDA 加速

### Q3: 桌面客户端无法启动
**A**:
- 检查 Node.js 是否已安装
- 运行 `cd desktop_launcher && npm install` 安装依赖
- 确保后端服务已启动（端口 12393）

### Q4: 图片上传后无响应
**A**:
- 确保 StepFun API 密钥正确
- 检查网络连接
- 图片大小不要超过 10MB
- 支持的格式: JPG, PNG, WebP

### Q5: 数学公式无法显示
**A**:
- 网页版可能需要刷新页面
- 桌面版检查是否加载了 KaTeX 库
- 确保公式语法正确（使用 `$...$` 或 `$$...$$`）

## 📊 性能优化

### GPU 加速配置

1. **FunASR CUDA 加速**
   ```yaml
   asr_config:
     fun_asr:
       device: 'cuda:0'  # 使用 GPU
   ```

2. **监控 GPU 使用**
   ```bash
   nvidia-smi
   ```

### 内存优化

如果内存不足：
1. 关闭其他占用内存的程序
2. 减少浏览器标签页
3. 调整 FunASR 线程数:
   ```yaml
   fun_asr:
     ncpu: 2  # 减少 CPU 线程数
   ```

## 🔧 开发者选项

### 启用调试模式

编辑 `desktop_launcher/main.js`:
```javascript
// 取消注释以下行
mainWindow.webContents.openDevTools({ mode: 'detach' });
```

### 查看日志

日志文件位置: `logs/debug_YYYY-MM-DD.log`

### 自定义提示词

编辑 `conf.yaml` 中的 `persona_prompt` 字段，或查看 `prompts/lingxi_assistant_prompt.md` 了解详细指南。

## 📚 技术栈

- **前端**: HTML, CSS, JavaScript, Live2D Cubism SDK
- **后端**: Python, FastAPI, WebSocket
- **桌面客户端**: Electron
- **语音识别**: FunASR (SenseVoiceSmall)
- **语音合成**: Edge TTS
- **大语言模型**: StepFun step-2-16k (支持视觉理解)
- **渲染**: Markdown-it, KaTeX

## 🤝 贡献与反馈

本项目基于 [Open-LLM-VTuber](https://github.com/t41372/Open-LLM-VTuber) 修改而来，专注于学习场景。

如有问题或建议，欢迎反馈！

## 📄 许可证

本项目遵循 MIT 许可证。

---

**祝学习愉快！** 📖✨
